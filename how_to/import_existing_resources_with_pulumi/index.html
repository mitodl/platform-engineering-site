<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Importing Resources That Already Exist Into Your Pulumi Stack - Platform Engineering Documentation Site</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Platform Engineering Documentation Site</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../pe-product-infra-map/" class="nav-link">This Document Will Help Map Formal Product Names To Infrastructure</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Discoveries</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../discoveries/fargate_service_discovery/" class="dropdown-item">Integrating Fargate Services Into Our Existing Systems Architecture</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">How to</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../OpenEdX_Prove_Build_Was_Deployed/" class="dropdown-item">Proving That A Particular OpenEdX Build Was Deployed To a Product Environment</a>
</li>
                                    
<li>
    <a href="../access_openedx_djange_manage/" class="dropdown-item">How To Access An OpenEdX Django Admin manage.py</a>
</li>
                                    
<li>
    <a href="../bump_sentry_credit/" class="dropdown-item">How To Bump Our Sentry Credits When We Run Out</a>
</li>
                                    
<li>
    <a href="../concourse_github_issues_user_guide/" class="dropdown-item">Concourse github Issues Workflow User Guide</a>
</li>
                                    
<li>
    <a href="../consul_incantations/" class="dropdown-item">Misbehaving consul cluster incident from 20231004-20231905</a>
</li>
                                    
<li>
    <a href="../deploying_concourse/" class="dropdown-item">Deploying Concourse</a>
</li>
                                    
<li>
    <a href="../developer_eks_access/" class="dropdown-item">Developer EKS Access</a>
</li>
                                    
<li>
    <a href="../enable_rapid_response_edxapp/" class="dropdown-item">Enable Rapid Responde in edxapp</a>
</li>
                                    
<li>
    <a href="../faking_it_with_consul_and_vault/" class="dropdown-item">Faking it with Consul and Vault</a>
</li>
                                    
<li>
    <a href="../getting_started_with_concourse/" class="dropdown-item">Getting Started Building Concourse Pipelines in Python</a>
</li>
                                    
<li>
    <a href="../heroku_config_vars/" class="dropdown-item">Heroku config vars</a>
</li>
                                    
<li>
    <a href="../heroku_dynosaur_management/" class="dropdown-item">Heroku Dynosaur Management</a>
</li>
                                    
<li>
    <a href="../heroku_log_drains/" class="dropdown-item">Heroku log drains</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Importing Resources That Already Exist Into Your Pulumi Stack</a>
</li>
                                    
<li>
    <a href="../mitol_deploy_app_with_kubernetes/" class="dropdown-item">Deploying an Application at MIT Open Learning with Kubernetes</a>
</li>
                                    
<li>
    <a href="../mitol_dev_access_to_vault/" class="dropdown-item">OL Secrets Management</a>
</li>
                                    
<li>
    <a href="../mitol_devops_patterns_cookbook/" class="dropdown-item">MIT OL Devops Patterns Cookbook</a>
</li>
                                    
<li>
    <a href="../mitol_kubernetes_cookbook/" class="dropdown-item">MIT OL Kubernetes Cookbook</a>
</li>
                                    
<li>
    <a href="../mitol_openedx_mysql_access/" class="dropdown-item">Querying An MIT OL Open EdX Mysql Database</a>
</li>
                                    
<li>
    <a href="../mitol_openedx_retirement_pipeline/" class="dropdown-item">Setting Up The Retirement Pipeline For A New MIT OL OpenEdX Application</a>
</li>
                                    
<li>
    <a href="../moira_certificates/" class="dropdown-item">Moira Certificates</a>
</li>
                                    
<li>
    <a href="../openedx_release_upgrades/" class="dropdown-item">How To Update The Release Version Of An Open edX Deployment</a>
</li>
                                    
<li>
    <a href="../publish_to_npm/" class="dropdown-item">How to Publish an MIT OL Package to NPM</a>
</li>
                                    
<li>
    <a href="../pulumi_aws_classic_5_to_6_upgrade/" class="dropdown-item">Pulumi AWS Classic 4 To 5 Upgrade</a>
</li>
                                    
<li>
    <a href="../recaptcha/" class="dropdown-item">reCAPTCHA Errors</a>
</li>
                                    
<li>
    <a href="../restore_vault_backups/" class="dropdown-item">So you broke vault?</a>
</li>
                                    
<li>
    <a href="../retire_an_openedx_user/" class="dropdown-item">How To Retire An MIT Online Learning OpenEdX User</a>
</li>
                                    
<li>
    <a href="../tagging_amis_with_installed_software_metadata/" class="dropdown-item">Tagging AMIs with Installed Software Metadata</a>
</li>
                                    
<li>
    <a href="../test_and_deploy_pulumi_packer_projects/" class="dropdown-item">How To Test And Deploy MIT OL Pulumi/Packer Projects</a>
</li>
                                    
<li>
    <a href="../transition_heroku_postgres_db_to_rds/" class="dropdown-item">Moving a Heroku Managed Postgres DB to Pulumi Managed AWS RDS</a>
</li>
                                    
<li>
    <a href="../update_this_site/" class="dropdown-item">Update this site</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Monitoring</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../monitoring/inventory/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="../../monitoring/key_labels/" class="dropdown-item">Key Labels used by ODL</a>
</li>
                                    
<li>
    <a href="../../monitoring/overview/" class="dropdown-item">Monitoring Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Post mortems</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../post-mortems/20231030_xpro_outage/" class="dropdown-item">xPro Outage - October 30, 2023</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Runbooks</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../runbooks/oncall/" class="dropdown-item">Oncall</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../heroku_log_drains/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../mitol_deploy_app_with_kubernetes/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="true">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#importing-resources-that-already-exist-into-your-pulumi-stack" class="nav-link">Importing Resources That Already Exist Into Your Pulumi Stack</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#summary" class="nav-link">Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#whole-cloth" class="nav-link">Whole Cloth</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#bring-on-the-special-import-sauce" class="nav-link">Bring On The Special (Import) Sauce</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#tuning" class="nav-link">Tuning</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cleaning-up" class="nav-link">Cleaning Up</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="importing-resources-that-already-exist-into-your-pulumi-stack">Importing Resources That Already Exist Into Your Pulumi Stack</h1>
<h2 id="summary">Summary</h2>
<p>There are several ways to skin this particular cat but Tobias has shown me one
that works really well so that's what we'll outline here.</p>
<p>There's another approach using the <a href="https://www.pulumi.com/docs/cli/commands/pulumi_import/">pulumi import CLI command</a>
but in my experience that brings in a bunch of extra attributes we don't want.
(There may be ways to tune this, I just don't know them.)</p>
<h2 id="whole-cloth">Whole Cloth</h2>
<p>Before you start importing, code your resources the same way you always would.</p>
<p>For example, if you need an S3 bucket, use all the usual Pulumi code -
s3.Bucket etc.</p>
<p>You want to code such that in a disaster recovery scenario, if we were staring from
scratch, the resources would get build 100% correctly and the applications they
support would pass all monitoring checks and smoke tests and function normally.</p>
<h2 id="bring-on-the-special-import-sauce">Bring On The Special (Import) Sauce</h2>
<p>If you know you want to keep existing resources while having Pulumi create the
rest, you should tell it to import these resources by passing in a
ResourceOptions object at resource creation time. Here's an example of our S3
bucket:</p>
<pre><code class="language-python">bootcamps_storage_bucket_name = f&quot;ol-bootcamps-app-{stack_info.env_suffix}&quot;
bootcamps_storage_bucket = s3.Bucket(
    f&quot;ol-bootcamps-app-{stack_info.env_suffix}&quot;,
    ### ****THIS LINE IS THE IMPORT CLAUSE****
    opts=ResourceOptions(import_=bootcamps_storage_bucket_name,ignore_changes=[]),
    bucket=bootcamps_storage_bucket_name,
    # ...
</code></pre>
<p>Note that obviously the object you're creating will differ if it's not an S3 bucket,
for example a Vault mount point.</p>
<h2 id="tuning">Tuning</h2>
<p>After having added the above code, go ahead and run pulumi up on your stack. At this
stage DO NOT SAY YES to finalizing these changes if there are any diagnostic warnigns
displayed.</p>
<p>Here's an example of something like what we'd expect:</p>
<pre><code># cpatti @ rocinante in ~/src/mit/ol-infrastructure/src/ol_infrastructure/applications/bootcamps on git:cpatti_pulumi_bootcamp x ol-infrastructure-yqmQEgvq-py3.11 [14:31:28]
$ pulumi up  -s applications.bootcamps_ecommerce.Production
Previewing update (applications.bootcamps_ecommerce.Production):
     Type                                                      Name                                                                                           Plan       Info
 +   pulumi:pulumi:Stack                                       ol-infrastructure-bootcamps-ecommerce-application-applications.bootcamps_ecommerce.Production  create
 +   ├─ ol:infrastructure:aws:database:OLAmazonDB              bootcamps-db-applications-production                                                           create
 +   │  ├─ aws:rds:ParameterGroup                              bootcamps-db-applications-production-postgres-parameter-group                                  create
 +   │  ├─ aws:rds:Instance                                    bootcamps-db-applications-production-postgres-instance                                         create
 +   │  └─ aws:rds:Instance                                    bootcamps-db-applications-production-postgres-replica                                          create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-CPUUtilization-OLCloudWatchAlarmSimpleRDSConfig           create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-CPUUtilization-simple-rds-alarm                           create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-WriteLatency-OLCloudWatchAlarmSimpleRDSConfig             create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-WriteLatency-simple-rds-alarm                             create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-FreeStorageSpace-OLCloudWatchAlarmSimpleRDSConfig         create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-FreeStorageSpace-simple-rds-alarm                         create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-EBSIOBlance-OLCloudWatchAlarmSimpleRDSConfig              create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-EBSIOBalance%-simple-rds-alarm                            create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-DiskQueueDepth-OLCloudWatchAlarmSimpleRDSConfig           create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-DiskQueueDepth-simple-rds-alarm                           create
 +   ├─ ol:infrastructure.aws.cloudwatch.OLCloudWatchAlarmRDS  bootcamps-db-applications-production-ReadLatency-OLCloudWatchAlarmSimpleRDSConfig              create
 +   │  └─ aws:cloudwatch:MetricAlarm                          bootcamps-db-applications-production-ReadLatency-simple-rds-alarm                              create
 +   ├─ ol:services:Vault:DatabaseBackend:postgresql           bootcamps                                                                                      create
 +   │  └─ vault:index:Mount                                   bootcamps-mount-point                                                                          create
 +   │     └─ vault:database:SecretBackendConnection           bootcamps-database-connection                                                                  create
 +   │        ├─ vault:database:SecretBackendRole              bootcamps-database-role-approle                                                                create
 +   │        ├─ vault:database:SecretBackendRole              bootcamps-database-role-admin                                                                  create
 +   │        ├─ vault:database:SecretBackendRole              bootcamps-database-role-readonly                                                               create
 +   │        └─ vault:database:SecretBackendRole              bootcamps-database-role-app                                                                    create
 +   ├─ pulumi:providers:vault                                 vault-provider                                                                                 create
 +   ├─ aws:iam:Policy                                         bootcamps-production-policy                                                                    create
 =   ├─ aws:s3:Bucket                                          ol-bootcamps-app-production                                                                    import     [diff: -tagsAll~tags]; 1 warning
 =   ├─ vault:index:Mount                                      bootcamps-vault-secrets-storage                                                                import
 +   ├─ aws:ec2:SecurityGroup                                  bootcamps-db-access-production                                                                 create
 +   └─ vault:aws:SecretBackendRole                            bootcamps-app-production                                                                       create


Diagnostics:
  aws:s3:Bucket (ol-bootcamps-app-production):
    warning: inputs to import do not match the existing resource; importing this resource will fail

Outputs:
    bootcamps_app: {
        rds_host: output&lt;string&gt;
    }

</code></pre>
<p>The two key bits of output to focus on here are the diagnostic warning towards the end:</p>
<pre><code>Diagnostics:
  aws:s3:Bucket (ol-bootcamps-app-production):
    warning: inputs to import do not match the existing resource; importing this resource will fail

</code></pre>
<p>This tells us that Pulumi has detected a critical difference between the
resource's state in the real world and Pulumi's model of what's there and
what needs to change to arrive at the desired state.</p>
<p>The next most important bit is nestled amongst Pulumi telling us what changes it plans to make:</p>
<p><code>=   ├─ aws:s3:Bucket                                          ol-bootcamps-app-production                                                                    import     [diff: -tagsAll~tags]; 1 warning</code></p>
<p>This tells us that an attribute, in this case the tags that we're specifying the
S3 bucket should have in our Pulumi source disagrees with what's actually
sitting out there on EC2.</p>
<p>In order to fix this discrepancy, we go back to our ResourceOptions line we added,
adding the tags attribute into it to tell Pulumi to leave the current tags alone
and not complain that they differ:</p>
<p><code>opts=ResourceOptions(import_=bootcamps_storage_bucket_name,ignore_changes=["policy","tags"]),</code></p>
<p>You'll also note that "policy" is in that attributes list. That's needed because
Pulumi signalled a mismatch on a previous run.</p>
<p>After these additions, your pulumi up should succeed and all the resources should be
created with no further warnings.</p>
<h2 id="cleaning-up">Cleaning Up</h2>
<p>After you've successfully built your environment with Pulumi and imported the
existing resources, you'll want to remove all those ResourceOptions lines
from your Pulumi model source as the import should only be done once.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
