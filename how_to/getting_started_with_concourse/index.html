<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Getting Started Building Concourse Pipelines in Python - Platform Engineering Documentation Site</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Platform Engineering Documentation Site</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Discoveries</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../discoveries/fargate_service_discovery/" class="dropdown-item">Integrating Fargate Services Into Our Existing Systems Architecture</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">How to</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../OpenEdX_Prove_Build_Was_Deployed/" class="dropdown-item">Proving That A Particular OpenEdX Build Was Deployed To a Product Environment</a>
</li>
                                    
<li>
    <a href="../access_openedx_djange_manage/" class="dropdown-item">How To Access An OpenEdX Django Admin manage.py</a>
</li>
                                    
<li>
    <a href="../bump_sentry_credit/" class="dropdown-item">How To Bump Our Sentry Credits When We Run Out</a>
</li>
                                    
<li>
    <a href="../concourse_github_issues_user_guide/" class="dropdown-item">Concourse github Issues Workflow User Guide</a>
</li>
                                    
<li>
    <a href="../consul_incantations/" class="dropdown-item">Misbehaving consul cluster incident from 20231004-20231905</a>
</li>
                                    
<li>
    <a href="../deploying_concourse/" class="dropdown-item">Deploying Concourse</a>
</li>
                                    
<li>
    <a href="../enable_rapid_response_edxapp/" class="dropdown-item">Enable Rapid Responde in edxapp</a>
</li>
                                    
<li>
    <a href="../faking_it_with_consul_and_vault/" class="dropdown-item">Faking it with Consul and Vault</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Getting Started Building Concourse Pipelines in Python</a>
</li>
                                    
<li>
    <a href="../heroku_config_vars/" class="dropdown-item">Heroku config vars</a>
</li>
                                    
<li>
    <a href="../heroku_dynosaur_management/" class="dropdown-item">Heroku Dynosaur Management</a>
</li>
                                    
<li>
    <a href="../heroku_log_drains/" class="dropdown-item">Heroku log drains</a>
</li>
                                    
<li>
    <a href="../import_existing_resources_with_pulumi/" class="dropdown-item">Importing Resources That Already Exist Into Your Pulumi Stack</a>
</li>
                                    
<li>
    <a href="../mitol_deploy_app_with_kubernetes/" class="dropdown-item">Deploying an Application at MIT Open Learning with Kubernetes</a>
</li>
                                    
<li>
    <a href="../mitol_dev_access_to_vault/" class="dropdown-item">OL Secrets Management</a>
</li>
                                    
<li>
    <a href="../mitol_devops_patterns_cookbook/" class="dropdown-item">MIT OL Devops Patterns Cookbook</a>
</li>
                                    
<li>
    <a href="../mitol_kubernetes_cookbook/" class="dropdown-item">MIT OL Kubernetes Cookbook</a>
</li>
                                    
<li>
    <a href="../mitol_openedx_mysql_access/" class="dropdown-item">Querying An MIT OL Open EdX Mysql Database</a>
</li>
                                    
<li>
    <a href="../mitol_openedx_retirement_pipeline/" class="dropdown-item">Setting Up The Retirement Pipeline For A New MIT OL OpenEdX Application</a>
</li>
                                    
<li>
    <a href="../moira_certificates/" class="dropdown-item">Moira Certificates</a>
</li>
                                    
<li>
    <a href="../openedx_release_upgrades/" class="dropdown-item">How To Update The Release Version Of An Open edX Deployment</a>
</li>
                                    
<li>
    <a href="../publish_to_npm/" class="dropdown-item">How to Publish an MIT OL Package to NPM</a>
</li>
                                    
<li>
    <a href="../pulumi_aws_classic_5_to_6_upgrade/" class="dropdown-item">Pulumi AWS Classic 4 To 5 Upgrade</a>
</li>
                                    
<li>
    <a href="../recaptcha/" class="dropdown-item">reCAPTCHA Errors</a>
</li>
                                    
<li>
    <a href="../restore_vault_backups/" class="dropdown-item">So you broke vault?</a>
</li>
                                    
<li>
    <a href="../retire_an_openedx_user/" class="dropdown-item">How To Retire An MIT Online Learning OpenEdX User</a>
</li>
                                    
<li>
    <a href="../tagging_amis_with_installed_software_metadata/" class="dropdown-item">Tagging AMIs with Installed Software Metadata</a>
</li>
                                    
<li>
    <a href="../test_and_deploy_pulumi_packer_projects/" class="dropdown-item">How To Test And Deploy MIT OL Pulumi/Packer Projects</a>
</li>
                                    
<li>
    <a href="../transition_heroku_postgres_db_to_rds/" class="dropdown-item">Moving a Heroku Managed Postgres DB to Pulumi Managed AWS RDS</a>
</li>
                                    
<li>
    <a href="../update_this_site/" class="dropdown-item">Update this site</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Monitoring</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../monitoring/inventory/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="../../monitoring/key_labels/" class="dropdown-item">Key Labels used by ODL</a>
</li>
                                    
<li>
    <a href="../../monitoring/overview/" class="dropdown-item">Monitoring Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Post mortems</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../post-mortems/20231030_xpro_outage/" class="dropdown-item">xPro Outage - October 30, 2023</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Runbooks</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../runbooks/oncall/" class="dropdown-item">Oncall</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../faking_it_with_consul_and_vault/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../heroku_config_vars/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="true">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#getting-started-building-concourse-pipelines-in-python" class="nav-link">Getting Started Building Concourse Pipelines in Python</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#getting-set-up" class="nav-link">Getting Set Up</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#now-were-cooking-with-gas-learning-how-concourse-works-by-building-pipelines" class="nav-link">Now We're Cooking with Gas! Learning How Concourse Works By Building Pipelines</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#it-gets-easier-building-pipelines-in-python" class="nav-link">It Gets Easier - Building Pipelines in Python</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#actually-building-a-pipeline-from-your-python" class="nav-link">Actually Building a Pipeline From Your Python</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="getting-started-building-concourse-pipelines-in-python">Getting Started Building Concourse Pipelines in Python</h1>
<h2 id="getting-set-up">Getting Set Up</h2>
<ul>
<li>Use the <a href="https://concourse-ci.org/getting-started.html">Tutorial</a> on the Concourse website under Docs-&gt;Getting Started to get set up.</li>
<li>Do NOT use any other tutorials you find linked elsewhere. Some are out of date and the failure modes can be incredibly hard to debug!</li>
<li>If you're using an Arm64 Mac (e.g. M1, M2, etc.) just substitute <a href="https://github.com/robinhuiser/concourse-arm64">this</a> platform specific image for the one cited in the tutorial. So the first line of your docker-compose.yml should look something like this: <code>image: rdclda/concourse:7.7.1</code></li>
<li>Nota Bene: You should probably use the latest version of this. At the time of this writing the latest has a bug but that will likely be fixed by the time anyone reads this.</li>
<li>You'll also need to install Docker Desktop for Mac.</li>
<li>Be sure that at the end of this process you have a Concourse instance running locally in your Docker install. If you
    didn't end up running <code>docker-compose up -d</code> or similar then you may have missed something. Watch for errors and check that your newly launched Concourse is healthy and that you can browse to the localhost URL cited in the tutorial which should get you the Concourse main page with the giant spinning turbine blade icon.</li>
</ul>
<h2 id="now-were-cooking-with-gas-learning-how-concourse-works-by-building-pipelines">Now We're Cooking with Gas! Learning How Concourse Works By Building Pipelines</h2>
<ul>
<li>Work through the entire tutorial including building and actually creating pipelines from all the examples. This is critical so
you'll have an understanding of what all the component parts are and how they fit together as you code your Python in later steps.</li>
<li>Actually make a point of working with some of the later examples involving Git repos. Commit some chnges to your test repo and
watch them flow through the pipeline. Pretty neat eh?</li>
<li>You may notice that some of the later examples get pretty unwieldy and become difficult to get right. It can be tricky figuring
out what level of indentation is correct just by eyeballing it. You might find the <a href="https://github.com/adrienverge/yamllint">yamllint</a>
utility helpful for this as it will tell you when there are syntax errors. Ignore its whining about improper indent levels and
focus on the errors :)</li>
</ul>
<h2 id="it-gets-easier-building-pipelines-in-python">It Gets Easier - Building Pipelines in Python</h2>
<p>Thankfully, we have been spared the pain of coding pipelines in YAML by virtue of a <a href="https://github.com/mitodl/ol-infrastructure/tree/main/src/ol_concourse">Python wrapper</a>
that Tobias Macey wrote.</p>
<p>Each YAML section is wrapped in a Python object. It's a 1 to 1 mapping because the Python models are auto-generated from the
schema defined by Concourse.</p>
<p>Tahe a look at the simplest hello-world tutorial example converted into Python <a href="">here</a>. I've put the explanatory comments inline
to make it easier to understand what's going on.</p>
<h2 id="actually-building-a-pipeline-from-your-python">Actually Building a Pipeline From Your Python</h2>
<p>Our Concourse pipeline Python build scripts, like everything else we maintain, is managed by <a href="https://python-poetry.org/">Poetry</a>.</p>
<p>So, to actually invoke our hello world script and get ready to actually create the pipeline, we run:
<code>poetry run python3 ./hello.py</code></p>
<p>This will emit the JSON our Python produces, along with an actual Concourse <code>fly</code> invocation at the end. This assumes you're
already properly logged into your Concourse instance. For our purposes use the same one you set up previously to run through the
tutorials.</p>
<p>The output should look something like this:</p>
<pre><code class="language-json">{
  &quot;jobs&quot;: [
    {
      &quot;build_logs_to_retain&quot;: null,
      &quot;max_in_flight&quot;: 1.0,
      &quot;serial&quot;: null,
      &quot;old_name&quot;: null,
      &quot;on_success&quot;: null,
      &quot;ensure&quot;: null,
      &quot;on_error&quot;: null,
      &quot;disable_manual_trigger&quot;: null,
      &quot;serial_groups&quot;: null,
      &quot;build_log_retention&quot;: null,
      &quot;name&quot;: &quot;deploy-hello-world&quot;,
      &quot;plan&quot;: [
        {
          &quot;config&quot;: {
            &quot;image_resource&quot;: {
              &quot;source&quot;: {
                &quot;repository&quot;: &quot;busybox&quot;,
                &quot;tag&quot;: &quot;latest&quot;
              },
              &quot;params&quot;: null,
              &quot;version&quot;: null,
              &quot;type&quot;: &quot;registry-image&quot;
            },
            &quot;caches&quot;: null,
            &quot;run&quot;: {
              &quot;args&quot;: [
                &quot;Hello, World!&quot;
              ],
              &quot;user&quot;: null,
              &quot;path&quot;: &quot;echo&quot;,
              &quot;dir&quot;: null
            },
            &quot;inputs&quot;: null,
            &quot;platform&quot;: &quot;linux&quot;,
            &quot;params&quot;: null,
            &quot;container_limits&quot;: null,
            &quot;outputs&quot;: null,
            &quot;rootfs_uri&quot;: null
          },
          &quot;file&quot;: null,
          &quot;params&quot;: null,
          &quot;task&quot;: &quot;hello-task&quot;,
          &quot;privileged&quot;: null,
          &quot;vars&quot;: null,
          &quot;output_mapping&quot;: null,
          &quot;image&quot;: null,
          &quot;input_mapping&quot;: null,
          &quot;container_limits&quot;: null
        }
      ],
      &quot;interruptible&quot;: null,
      &quot;public&quot;: null,
      &quot;on_failure&quot;: null,
      &quot;on_abort&quot;: null
    }
  ],
  &quot;groups&quot;: null,
  &quot;resource_types&quot;: null,
  &quot;var_sources&quot;: null,
  &quot;display&quot;: null,
  &quot;resources&quot;: null
}
</code></pre>
<pre><code class="language-bash">fly -t pr-inf sp -p misc-cloud-hello -c definition.json
</code></pre>
<p>Since we'll be using fly to create our pipeline in the tutorial Concourse instance, use -t tutorial rather than pr-inf and make
any other necessary substitutions according to your environment.</p>
<p>That's it! You should now have the basic Hello World pipeline created from your Python source and operating properly, printing
that famous phrase as a result.</p>
<p><em>TODO</em> Add a more meaty example like the the-artifact example so we get to show inputs and outputs.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
