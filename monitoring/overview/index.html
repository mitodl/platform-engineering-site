<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Monitoring Overview - Platform Engineering Documentation Site</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Platform Engineering Documentation Site</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Discoveries</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../discoveries/fargate_service_discovery/" class="dropdown-item">Integrating Fargate Services Into Our Existing Systems Architecture</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">How to</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../how_to/access_openedx_djange_manage/" class="dropdown-item">How To Access An OpenEdX Django Admin manage.py</a>
</li>
                                    
<li>
    <a href="../../how_to/concourse_github_issues_user_guide/" class="dropdown-item">The Problem</a>
</li>
                                    
<li>
    <a href="../../how_to/consul_incantations/" class="dropdown-item">Misbehaving consul cluster incident from 20231004-20231905</a>
</li>
                                    
<li>
    <a href="../../how_to/deploying_concourse/" class="dropdown-item">Summary</a>
</li>
                                    
<li>
    <a href="../../how_to/enable_rapid_response_edxapp/" class="dropdown-item">Reference</a>
</li>
                                    
<li>
    <a href="../../how_to/faking_it_with_consul_and_vault/" class="dropdown-item">Faking it with Consul and Vault</a>
</li>
                                    
<li>
    <a href="../../how_to/getting_started_with_concourse/" class="dropdown-item">Getting Started Building Concourse Pipelines in Python</a>
</li>
                                    
<li>
    <a href="../../how_to/heroku_config_vars/" class="dropdown-item">Heroku config vars</a>
</li>
                                    
<li>
    <a href="../../how_to/heroku_dynosaur_management/" class="dropdown-item">Heroku Dynosaur Management</a>
</li>
                                    
<li>
    <a href="../../how_to/heroku_log_drains/" class="dropdown-item">Heroku log drains</a>
</li>
                                    
<li>
    <a href="../../how_to/import_existing_resources_with_pulumi/" class="dropdown-item">Importing Resources That Already Exist Into Your Pulumi Stack</a>
</li>
                                    
<li>
    <a href="../../how_to/mitol_deploy_app_with_kubernetes/" class="dropdown-item">Deploying an Application at MIT Open Learning with Kubernetes</a>
</li>
                                    
<li>
    <a href="../../how_to/mitol_devops_patterns_cookbook/" class="dropdown-item">Summary</a>
</li>
                                    
<li>
    <a href="../../how_to/mitol_openedx_retirement_pipeline/" class="dropdown-item">Setting Up The Retirement Pipeline For A New MIT OL OpenEdX Application</a>
</li>
                                    
<li>
    <a href="../../how_to/moira_certificates/" class="dropdown-item">Moira Certificates</a>
</li>
                                    
<li>
    <a href="../../how_to/publish_to_npm/" class="dropdown-item">How to Publish an MIT OL Package to NPM</a>
</li>
                                    
<li>
    <a href="../../how_to/pulumi_aws_classic_5_to_6_upgrade/" class="dropdown-item">Pulumi aws classic 5 to 6 upgrade</a>
</li>
                                    
<li>
    <a href="../../how_to/recaptcha/" class="dropdown-item">reCAPTCHA Errors</a>
</li>
                                    
<li>
    <a href="../../how_to/restore_vault_backups/" class="dropdown-item">So you broke vault?</a>
</li>
                                    
<li>
    <a href="../../how_to/retire_an_openedx_user/" class="dropdown-item">How To Retire An MIT Online Learning OpenEdX User</a>
</li>
                                    
<li>
    <a href="../../how_to/tagging_amis_with_installed_software_metadata/" class="dropdown-item">Tagging AMIs with Installed Software Metadata</a>
</li>
                                    
<li>
    <a href="../../how_to/test_and_deploy_pulumi_packer_projects/" class="dropdown-item">How To Test And Deploy MIT OL Pulumi/Packer Projects</a>
</li>
                                    
<li>
    <a href="../../how_to/transition_heroku_postgres_db_to_rds/" class="dropdown-item">Moving a Heroku Managed Postgres DB to Pulumi Managed AWS RDS</a>
</li>
                                    
<li>
    <a href="../../how_to/update_this_site/" class="dropdown-item">Update this site</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Openedx</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../how_to/openedx/release_upgrades/" class="dropdown-item">How To Update The Release Version Of An Open edX Deployment</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Monitoring</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../inventory/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="../key_labels/" class="dropdown-item">Key Labels used by ODL</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Monitoring Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Post mortems</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../post-mortems/20231030_xpro_outage/" class="dropdown-item">xPro Outage - October 30, 2023</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Runbooks</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../runbooks/oncall/" class="dropdown-item">Oncall</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../key_labels/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../post-mortems/20231030_xpro_outage/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="true">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#monitoring-overview" class="nav-link">Monitoring Overview</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#metrics" class="nav-link">Metrics</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#logs" class="nav-link">Logs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#vector-patterns" class="nav-link">Vector Patterns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="monitoring-overview">Monitoring Overview</h1>
<p>We primarily use <a href="https://vector.dev/">Vector</a> for collecting both metrics and logs from our applications. Vector is pretty flexible and offers <code>sources</code> and <code>sinks</code> to/from many different systems.</p>
<h2 id="metrics">Metrics</h2>
<p>Ultimately we utilize <a href="https://prometheus.io/">Prometheus</a>, but our stack is a little non-traditional.</p>
<p>For our applications in EC2, we use Vector as a middleman to perform the 'prometheus-scrape' action, rather than performing the scrape with an actual prometheus instance that we would have to run. Right at scrape time, on the node performing the scrape, we can perform <code>transforms</code> on the data to drop timeseries that we are not interested in or add labels + metadata that would be helpful. This is good, because we are charged by the timeseries in GrafanaCloud and many prometheus endpoints produce lots of not-interesting data. The more we can drop early, the better. Once it is in GrafanaCloud, we pay for it.</p>
<p>After the transforms, Vector ships the data straight to GrafanaCloud where it is stored in Cortex, which is actually <em>not</em> prometheus but it is API compatible and the distinction isn't important to us.</p>
<h2 id="logs">Logs</h2>
<p>For log collection and aggregation, we again are using Vector and GrafanaCloud. Vector is also very good at collecting and parsing logfiles and again we can utilize its ability to <code>transform</code> the data to drop not-interesting data and save a little money.</p>
<p>After any transforms on the log data are completed, Vector ships the data straight to GrafanaCloud again and it is stored in <a href="https://grafana.com/oss/loki/">Loki</a>. Loki is like a hybrid of ElasticSearch and Prometheus and it has its own <a href="https://grafana.com/docs/loki/latest/logql/">query language</a>.</p>
<h2 id="vector-patterns">Vector Patterns</h2>
<p>There are a couple different patterns at play in our environment.</p>
<h3 id="applications-deployed-into-ec2">Applications deployed into EC2</h3>
<blockquote>
<p>The statements below do not necessarily apply to EC2 instances managed with salt-stack</p>
</blockquote>
<p>For applications deployed in EC2, we install and configure Vector at AMI build time. We pull in global secrets (values that are the same regardless of where the AMI is running) at build time. Other secrets are interpolated runtime secrets using environment variables populated via <code>/etc/default/</code> files and vault-template.</p>
<p>Examples:
- Config files laid down at AMI build time <a href="https://github.com/mitodl/ol-infrastructure/blob/main/src/bilder/images/concourse/templates/vector">here</a>
- <code>/etc/default</code> secrets from runtime <a href="https://github.com/mitodl/ol-infrastructure/blob/main/src/ol_infrastructure/applications/concourse/__main__.py">here</a></p>
<h3 id="applications-deployed-in-heroku">Applications deployed in Heroku</h3>
<p>Specifics of collecting logs out of Heroku are covered <a href="https://github.com/mitodl/ol-infrastructure/blob/main/src/ol_infrastructure/infrastructure/vector_log_proxy/README.md">here</a></p>
<h3 id="applications-deployed-into-ecs">Applications deployed into ECS</h3>
<p>Coming soon!</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
